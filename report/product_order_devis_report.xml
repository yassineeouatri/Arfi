<?xml version="1.0" encoding="utf-8"?>
<odoo>
<template id="product_order_devis_layout">
    <t t-if="o and 'company_id' in o">
        <t t-set="company" t-value="o.company_id"></t>
    </t>
    <t t-if="not o or not 'company_id' in o">
        <t t-set="company" t-value="res_company"></t>
    </t>
    <t t-call="arfi.product_order_devis_report_header" />
    <t t-raw="0" />
    <t t-call="report.external_layout_footer" />
</template>

<template id="product_order_devis_report_header">
    <div class="header">
         <div class="row">
            <div class="col-xs-3">
                <img t-if="company.logo" t-att-src="'data:image/png;base64,%s' % company.logo" style="max-height: 100px;border: 1px solid black;"/>
            </div>
            <div class="col-xs-6 text-center" style="padding-top: 40px;">
            	<h2 style="border: solid 1px;width: 500px;margin: 0 auto">Devis</h2> 
            </div>
            <div class="col-xs-3 text-right" style="font-size: 10px">Imprimé le : <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%d/%m/%Y')"/></div>
            
        </div>
        <div class="row zero_min_height" style="padding-top: 5px;">
            <div class="col-xs-12">
                <div style="border-bottom: 1px solid black;"></div>
            </div>
        </div>
        <div class="row zero_min_height">
            <div class="col-xs-12">
                <div style="border-bottom: 1px solid black;"></div>
            </div>
        </div>    
    </div>
</template>	

<template id="product_order_realisation_layout">
    <t t-if="o and 'company_id' in o">
        <t t-set="company" t-value="o.company_id"></t>
    </t>
    <t t-if="not o or not 'company_id' in o">
        <t t-set="company" t-value="res_company"></t>
    </t>
    <t t-call="arfi.product_order_realisation_report_header" />
    <t t-raw="0" />
    <t t-call="report.external_layout_footer" />
</template>

<template id="product_order_realisation_report_header">
    <div class="header">
         <div class="row">
            <div class="col-xs-3">
                <img t-if="company.logo" t-att-src="'data:image/png;base64,%s' % company.logo" style="max-height: 100px;border: 1px solid black;"/>
            </div>
            <div class="col-xs-6 text-center" style="padding-top: 40px;">
            	<h2 style="border: solid 1px;width: 500px;margin: 0 auto">Récapitulatif Prévu/Réalisé</h2> 
            </div>
            <div class="col-xs-3 text-right" style="font-size: 10px">Imprimé le : <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%d/%m/%Y')"/></div>
            
        </div>
        <div class="row zero_min_height" style="padding-top: 5px;">
            <div class="col-xs-12">
                <div style="border-bottom: 1px solid black;"></div>
            </div>
        </div>
        <div class="row zero_min_height">
            <div class="col-xs-12">
                <div style="border-bottom: 1px solid black;"></div>
            </div>
        </div>    
    </div>
</template>	
<template id="action_report_productorderdevis">
    <t t-call="arfi.product_order_devis_layout">
    	<t t-call="report.html_container">
	        <div class="page">
	        	<t t-foreach="docs" t-as="template">     		
	        		<div class="row">
	        			<p style="color : blue" ><u><strong>Informations commande :</strong></u></p>
	        			<div class="col-xs-6"  >
		        			<p><strong>Numéro commande :</strong><span t-field="template.no_order"/></p>
				            <p><strong>Date commande   :</strong><span t-field="template.date_order"/></p>
				        </div> 
				        <div class="col-xs-6"  >
		        			<p><strong>Client :</strong><span t-field="template.customer_id.name"/></p>
				            <p><strong>Lieu   :</strong><span t-field="template.place_id.description"/></p>
				        </div> 
		       		</div>
		       		<div class="row">
		       			<p style="color : blue"><u><strong>Informations Appareil :</strong></u></p>
	        			<div class="col-xs-6"  >
		        			<p><strong>Fabriquant :</strong><span t-field="template.maker_id.name"/></p>
				            <p><strong>Type :</strong><span t-field="template.ss_type_appareil_id.description"/></p>
				            <p><strong>Référence :</strong><span t-field="template.reference_appareil"/></p>
				        </div> 
				        <div class="col-xs-6"  >
		        			<p><strong>N° ARFI :</strong><span t-field="template.no_arfi"/></p>
				            <p><strong>N° Série :</strong><span t-field="template.no_serie"/></p>
				            <p><strong>KKS :</strong><span t-field="template.kks_id.name"/></p>
				        </div> 
		       		</div>
		       		
					<div class="row">
						<p style="color : blue"><u><strong>Caractéristiques :</strong></u></p>
	        			<div class="col-xs-6">
		        			 <table class="table table-condensed table table-striped table table-bordered">
				                <thead style=" background-color: #3498DB;" >
				                    <tr>
				                        <th class="text-center"><font color="#fff">Mesure</font></th>
				                        <th class="text-center"><font color="#fff">Valeur</font></th>
				                    </tr>
				                </thead>
				                <tbody class="invoice_tbody">
				                    <tr t-foreach="template.appareil_id.attribute_line_ids.sorted(key=lambda b: b.attribute_id.sequence)" t-as="l">
				                        <td>
				                            <span t-field="l.attribute_id.name"/>
				                        </td>
				                        <td>
				                            <span t-field="l.value"/>
				                        </td>
				                    </tr>
				                </tbody>
				            </table>
				        </div> 
				        <div class="col-xs-6"  >
				        	<p><strong>Autres caractéristiques</strong></p> 
		        			 <table class="table table-condensed table table-striped table table-bordered">
				                <tbody class="invoice_tbody">
				                    <tr t-foreach="template.service_ids" t-as="l">
				                        <td>
				                            <span t-field="l.service_id.name"/>
				                        </td>
				                        <td>
				                            <span t-field="l.value"/>
				                        </td>
				                    </tr>
				                </tbody>
				             </table>
				        </div> 
		       		</div>
		       		<div class="row">
		       			<p  style="color : blue"><u>Appareil :</u></p> 
	        			<div class="col-xs-12"  >		
		        			 <table class="table table-condensed  table table-striped table table-bordered">
				                <thead style=" background-color: #3498DB;"  >
				                    <tr>
				                        <th class="text-center" colspan="4"><font color="#fff">Opération</font></th>
				                        <th class="text-center" colspan="2"><font color="#fff">Prix</font></th>
				                    </tr>
				                </thead>
				                <tbody class="invoice_tbody">
				                    <tr t-foreach="template.operation_appareil_ids" t-as="l">
				                        <td colspan="4"><span t-field="l.operation_id.name"/></td>
				                        <td class="text-center" colspan="2"><span t-esc="round(l.price,2)"/></td>
				                    </tr>
				                </tbody>
				                <tr>
	                                <td colspan="6" class="text-left"></td>
	                            </tr>
				                <tr>
									 <td class="text-left" colspan="4"> </td>
									 <td class="text-right" colspan="2">Sous Total : 
									      <t t-set="subtotal_appareil" t-value="sum(l.price for l in template.operation_appareil_ids)"/>
	                                	<strong><span t-esc="subtotal_appareil"/></strong></td>
								</tr>
				            </table>
				        </div> 
		       		</div>	     
		       		<div class="row">
		       			<p style="color : blue"><u>Pièces :</u></p> 
	        			<div class="col-xs-12">
		        			 <table class="table table-condensed  table table-striped table table-bordered">
				                <thead style=" background-color: #3498DB;"  >
				                    <tr>
				                        <th class="text-center" colspan="4"><font color="#fff">Opération</font></th>
				                        <th class="text-center" colspan="4"><font color="#fff">Prix</font></th>
				                    </tr>
				                </thead>
				                <tbody class="invoice_tbody">
				                	<t t-set="product_piece" t-value="[]"/>
									<t t-foreach="template.operation_piece_ids" t-as="l">
									    <t t-set="product_piece" t-value="product_piece+[l.piece_id]"/>
									</t>
									<t t-foreach="set(product_piece)" t-as="piece">
										<t t-set="sub_total" t-value="0"/>
									    <tr><td></td></tr>
									    <t t-foreach="template.operation_piece_ids" t-as="l">
									        <t t-if="piece.id==l.piece_id.id">
									        	<t t-set="sub_total" t-value="sub_total+l.price"/>
									            <tr>
									            	<td colspan="4"><span t-field="l.operation_id.name"/></td>
							                        <td class="text-center" colspan="4"><span t-field="l.price"/></td>
						                        </tr>
									        </t>
									    </t>
									     <tr>
									     	<td class="text-left" colspan="4"><strong t-esc="piece.name"/> </td>
									        <td class="text-right" colspan="4">Sous Total : <strong t-esc="sub_total"/></td>
									     </tr>
									</t>
				                </tbody>
				                <tr>
	                                <td colspan="6" class="text-left"></td>
	                            </tr>
				                <tr>
									 <td class="text-left" colspan="4"> </td>
									 <td class="text-right" colspan="4">Total Commande : 
									      <t t-set="total" t-value="sum(l.price for l in template.operation_appareil_ids)+sum(l.price for l in template.operation_piece_ids)"/>
	                                  <strong><span t-esc="total"/></strong></td>
								</tr>
				            </table>
				        </div> 
		       		</div>	
		       	</t>	
        	</div>
        </t>
    </t>
</template>
<template id="report_productorderdevis"> 
	<t t-call="report.html_container">
        <t t-foreach="docs" t-as="o">
            <t t-call="arfi.product_order_devis_layout">
                <div class="page">
                    <div class="oe_structure"/>    
	        		<div class="row">
	        			<div class="col-xs-6"  >
		        			<p><strong>Numéro commande : </strong><span t-field="o.no_order"/></p>
				            <p><strong>Date commande   : </strong><span t-field="o.date_order"/></p>
				        </div> 
				        <div class="col-xs-6"  >
		        			<p><strong>Client :</strong> <span t-field="o.customer_id.name"/></p>
				            <p><strong>Lieu   :</strong> <span t-field="o.place_id.description"/></p>
				        </div> 
				    </div>    
		       		<div class="row" style="padding-top: 5px;">
		       			<div class="col-xs-12"  >	       		
		       				<p style="border: solid 1px;width: 180px;padding-left: 10px;"><strong>Informations Appareil :</strong></p>
	        			</div>
	        		</div>	
	        		<div class="row" style="padding-top: 5px;">	
		       			<div class="col-xs-6"  >
		        			<p><strong>Fabriquant : </strong><span t-field="o.maker_id.name"/></p>
				            <p><strong>Type : </strong><span t-field="o.ss_type_appareil_id.description"/></p>
				            <p><strong>Référence : </strong><span t-field="o.reference_appareil"/></p>
				        </div> 
				        <div class="col-xs-6"  >
		        			<p><strong>N° ARFI : </strong><span t-field="o.no_arfi"/></p>
				            <p><strong>N° Série : </strong><span t-field="o.no_serie"/></p>
				            <p><strong>KKS : </strong><span t-field="o.kks_id.name"/></p>
				        </div> 
		       		</div>
		       		
					<div class="row" style="padding-top: 5px;">
						<div class="col-xs-6">
		        			 <table class="table table-condensed table table-bordered">
				                <thead>
				                    <tr style="background-color : #ddd">
				                        <th style="border: 1px solid black;" class="text-center">Mesure</th>
				                        <th style="border: 1px solid black;" class="text-center">Valeur</th>
				                    </tr>
				                </thead>
				                <tbody class="invoice_tbody">
				                    <tr t-foreach="o.appareil_id.attribute_line_ids.sorted(key=lambda b: b.attribute_id.sequence)" t-as="l">
				                        <td style="border: 1px solid black;"><span t-field="l.attribute_id.name"/></td>
				                        <td style="border: 1px solid black;"><span t-field="l.value"/></td>
				                    </tr>
				                </tbody>
				            </table>
				        </div> 
				        <div class="col-xs-6"  >
				        	<p><strong>Autres caractéristiques</strong></p> 
		        			 <table class="table table-condensed table table-bordered">
				                <tbody class="invoice_tbody">
				                    <tr t-foreach="o.service_ids" t-as="l">
				                        <td style="border: 1px solid black;"><span t-field="l.service_id.name"/></td>
				                        <td style="border: 1px solid black;"><span t-field="l.value"/></td>
				                    </tr>
				                </tbody>
				             </table>
				        </div> 
		       		</div>	       		
				    <div class="row">
		    			<table class="table table-condensed">
			                <tbody>
			                	<tr>
			                        <td style="border-top: 1px solid black;border-bottom: 1px solid black;" class="text-left" colspan="6"><strong>Appareil</strong></td>
				                </tr>
			                	<t t-set="sub_total" t-value="0"/>
			                	<t t-set="total" t-value="0"/>
			                    <tr t-foreach="o.operation_appareil_ids" t-as="l" style="border-bottom: 1px solid black;">
			                    	<t t-set="sub_total" t-value="sub_total+l.price"/>			                    	
			                        <td colspan="4"><span t-field="l.operation_id.name"/></td>
				                    <td class="text-center" colspan="2"><span t-esc="'%.2f'%(l.price)"/></td>
			                    </tr>
			                    <tr> 
			                	 	<td  style="border-bottom: 1px solid white;" colspan="4"> </td>
			                	 	<td  style="border-bottom: 1px solid;" colspan="2"> </td>
								</tr>
				                <tr> 
				                	 <t t-set="total" t-value="sub_total+total"/>	
									 <td class="text-left" colspan="4" style="border-bottom: 1px solid;"> </td>
									 <td class="text-center" colspan="2"  style="border: solid 1px;"><strong>Sous Total : <span t-esc="'%.2f'%(sub_total)"/></strong></td>
								</tr>
			                </tbody>			                
							<tbody class="invoice_tbody">
			                	<t t-set="product_piece" t-value="[]"/>
								<t t-foreach="o.operation_piece_ids.sorted(key=lambda b: b.piece_id.order_)" t-as="l">
									<t t-if="l.piece_id not in product_piece">								    
								   	 	<t t-set="product_piece" t-value="product_piece+[l.piece_id]"/> 
									</t>
								</t>
								<t t-foreach="product_piece" t-as="piece">
									<t t-set="sub_total" t-value="0"/>
									<tr><td style="border-bottom: 1px solid white;" colspan="6"> </td></tr>
									<tr><td style="border-bottom: 1px solid;" colspan="6"></td></tr>
			                	    <tr>
								     	<t t-set="total" t-value="sub_total+total"/>
								     	<td  style="border-top: 1px solid black;border-bottom: 1px solid black;" class="text-left" colspan="6"><strong t-esc="piece.name"/>(<strong t-esc="piece.no_piece"/>) </td>
								    </tr>
								    <t t-foreach="o.operation_piece_ids.sorted(key=lambda b: b.piece_id.order_)" t-as="l">
								        <t t-if="piece.id==l.piece_id.id">
								        	<t t-set="sub_total" t-value="sub_total+l.price"/>
								            <tr>
								            	<td  colspan="4"><span t-field="l.operation_id.name"/></td>
						                        <td class="text-center" colspan="2"><span t-esc="'%.2f'%(l.price)"/></td>
					                        </tr>
								        </t>
								    </t>
								    <tr> 
				                	 	<td  style="border-bottom: 1px solid white;" colspan="4"> </td>
				                	 	<td  style="border-bottom: 1px solid;" colspan="2"> </td>
									</tr>
								     <tr>
								     	<t t-set="total" t-value="sub_total+total"/>
								     	<td class="text-left" colspan="4" style="border-bottom: solid 1px;"></td>
								        <td class="text-center" colspan="2" style="border: solid 1px;"><strong>Sous Total : <span t-esc="'%.2f'%(sub_total)"/></strong></td>
								     </tr>
								</t>
			                </tbody>
			                <tr> 
		                	 	<td  style="border-bottom: 1px solid white;" colspan="4"> </td>
		                	 	<td  style="border-bottom: 1px solid;" colspan="2"> </td>
							</tr>
							<tr>
								 <td class="text-left"  colspan="4" style="border-bottom: solid 1px;"> </td>
								 <td class="text-center" colspan="2" style="border: solid 1px;"><strong>Total Commande : <span t-esc="'%.2f'%(total)"/></strong></td>
							</tr>
			            </table>
		       		</div> 	
		       	</div> 
	        </t>
	        <t t-call="arfi.product_order_devis_layout">
                <div class="page">
		       		<div class="row" style="padding-top: 15px;">
		       			<p><u><strong>Observations :</strong></u></p>
		       			<p t-raw="o.obs_devis"/>
		       		</div> 
		       	</div>
	        </t>
	        </t>
	   </t>
       
</template>
<template id="report_productorderdevisempty"> 
	<t t-call="report.html_container">
        <t t-foreach="docs" t-as="o">
            <t t-call="arfi.product_order_devis_layout">
                <div class="page">
                    <div class="oe_structure"/>    
	        		<div class="row">
	        			<div class="col-xs-6"  >
		        			<p><strong>Numéro commande : </strong><span t-field="o.no_order"/></p>
				            <p><strong>Date commande   : </strong><span t-field="o.date_order"/></p>
				        </div> 
				        <div class="col-xs-6"  >
		        			<p><strong>Client :</strong> <span t-field="o.customer_id.name"/></p>
				            <p><strong>Lieu   :</strong> <span t-field="o.place_id.description"/></p>
				        </div> 
				    </div>    
		       		<div class="row" style="padding-top: 5px;">
		       			<div class="col-xs-12"  >	       		
		       				<p style="border: solid 1px;width: 180px;padding-left: 10px;"><strong>Informations Appareil :</strong></p>
	        			</div>
	        		</div>	
	        		<div class="row" style="padding-top: 5px;">	
		       			<div class="col-xs-6"  >
		        			<p><strong>Fabriquant : </strong><span t-field="o.maker_id.name"/></p>
				            <p><strong>Type : </strong><span t-field="o.ss_type_appareil_id.description"/></p>
				            <p><strong>Référence : </strong><span t-field="o.reference_appareil"/></p>
				        </div> 
				        <div class="col-xs-6"  >
		        			<p><strong>N° ARFI : </strong><span t-field="o.no_arfi"/></p>
				            <p><strong>N° Série : </strong><span t-field="o.no_serie"/></p>
				            <p><strong>KKS : </strong><span t-field="o.kks_id.name"/></p>
				        </div> 
		       		</div>
		       		
					<div class="row" style="padding-top: 5px;">
						<div class="col-xs-6">
		        			 <table class="table table-condensed table table-bordered">
				                <thead>
				                    <tr style="background-color : #ddd">
				                        <th style="border: 1px solid black;" class="text-center">Mesure</th>
				                        <th style="border: 1px solid black;" class="text-center">Valeur</th>
				                    </tr>
				                </thead>
				                <tbody class="invoice_tbody">
				                    <tr t-foreach="o.appareil_id.attribute_line_ids.sorted(key=lambda b: b.attribute_id.sequence)" t-as="l">
				                        <td style="border: 1px solid black;"><span t-field="l.attribute_id.name"/></td>
				                        <td style="border: 1px solid black;"><span t-field="l.value"/></td>
				                    </tr>
				                </tbody>
				            </table>
				        </div> 
				        <div class="col-xs-6"  >
				        	<p><strong>Autres caractéristiques</strong></p> 
		        			 <table class="table table-condensed table table-bordered">
				                <tbody class="invoice_tbody">
				                    <tr t-foreach="o.service_ids" t-as="l">
				                        <td style="border: 1px solid black;"><span t-field="l.service_id.name"/></td>
				                        <td style="border: 1px solid black;"><span t-field="l.value"/></td>
				                    </tr>
				                </tbody>
				             </table>
				        </div> 
		       		</div>				       		
				    <div class="row">
		    			<table class="table table-condensed">
			                <tbody>
			                	<tr><td style="border-top: 1px solid black;border-bottom: 1px solid black;" class="text-left" colspan="6"><strong>Appareil</strong></td></tr>
			                	<t t-set="total" t-value="0"/>
			                    <tr t-foreach="o.operation_appareil_ids" t-as="l">			                    	
			                        <td colspan="6"><span t-field="l.operation_id.name"/></td>
			                    </tr>
			                </tbody>
							<tbody class="invoice_tbody">
			                	<t t-set="product_piece" t-value="[]"/>
									<t t-foreach="o.operation_piece_ids.sorted(key=lambda b: b.piece_id.order_)" t-as="l">
									<t t-if="l.piece_id not in product_piece">								    
								   	 	<t t-set="product_piece" t-value="product_piece+[l.piece_id]"/> 
									</t>
								</t>
								<t t-foreach="product_piece" t-as="piece">
									<tr><td style="border-bottom: 1px solid white;" colspan="6"> </td></tr>
									<tr><td style="border-bottom: 1px solid black;" colspan="6"> </td></tr>
			                	    <tr><td style="border-bottom: 1px solid black;" class="text-left" colspan="6"><strong t-esc="piece.name"/>(<strong t-esc="piece.no_piece"/>) </td> </tr>
								    <t t-foreach="o.operation_piece_ids.sorted(key=lambda b: b.piece_id.order_)" t-as="l">
								        <t t-if="piece.id==l.piece_id.id">
								            <tr><td  colspan="6"><span t-field="l.operation_id.name"/></td></tr>
								        </t>
								    </t>								     
								</t>
								<tr><td style="border-bottom: 1px solid white;" colspan="6"></td></tr>
								<tr><td style="border-bottom: 1px solid black;" colspan="6"></td></tr>
								<tr><td style="border-bottom: 1px solid black;" class="text-right" colspan="6" ><strong>Total Commande : <span t-esc="'%.2f'%(total)"/></strong></td></tr>
			                </tbody>
			            </table>
		       		</div> 
		       	</div> 
	        </t>
	        <t t-call="arfi.product_order_devis_layout">
                <div class="page">
		       		<div class="row" style="padding-top: 15px;">
		       			<p><u><strong>Observations :</strong></u></p>
		       			<p t-raw="o.obs_devis"/>
		       		</div> 
		       	</div>
	        </t>
	     </t>
	   </t>
</template>
<template id="report_productorderrealisation"> 
	<t t-call="report.html_container">
        <t t-foreach="docs" t-as="o">
            <t t-call="arfi.product_order_realisation_layout">
                <div class="page">
                    <div class="oe_structure"/>    
	        		<div class="row">
	        			<div class="col-xs-6"  >
		        			<p><strong>Numéro commande : </strong><span t-field="o.no_order"/></p>
				            <p><strong>Date commande   : </strong><span t-field="o.date_order"/></p>
				        </div> 
				        <div class="col-xs-6"  >
		        			<p><strong>Client :</strong> <span t-field="o.customer_id.name"/></p>
				            <p><strong>Lieu   :</strong> <span t-field="o.place_id.description"/></p>
				        </div> 
				    </div>    
		       		<div class="row" style="padding-top: 5px;">
		       			<div class="col-xs-12"  >	       		
		       				<p style="border: solid 1px;width: 180px;padding-left: 10px;"><strong>Informations Appareil :</strong></p>
	        			</div>
	        		</div>	
	        		<div class="row" style="padding-top: 5px;">	
		       			<div class="col-xs-6"  >
		        			<p><strong>Fabriquant : </strong><span t-field="o.maker_id.name"/></p>
				            <p><strong>Type : </strong><span t-field="o.ss_type_appareil_id.description"/></p>
				            <p><strong>Référence : </strong><span t-field="o.reference_appareil"/></p>
				        </div> 
				        <div class="col-xs-6"  >
		        			<p><strong>N° ARFI : </strong><span t-field="o.no_arfi"/></p>
				            <p><strong>N° Série : </strong><span t-field="o.no_serie"/></p>
				            <p><strong>KKS : </strong><span t-field="o.kks_id.name"/></p>
				        </div> 
		       		</div>
		       		
					<div class="row" style="padding-top: 5px;">
						<div class="col-xs-6">
		        			 <table class="table table-condensed table table-bordered">
				                <thead>
				                    <tr style="background-color : #ddd">
				                        <th style="border: 1px solid black;" class="text-center">Mesure</th>
				                        <th style="border: 1px solid black;" class="text-center">Valeur</th>
				                    </tr>
				                </thead>
				                <tbody class="invoice_tbody">
				                    <tr t-foreach="o.appareil_id.attribute_line_ids.sorted(key=lambda b: b.attribute_id.sequence)" t-as="l">
				                        <td style="border: 1px solid black;"><span t-field="l.attribute_id.name"/></td>
				                        <td style="border: 1px solid black;"><span t-field="l.value"/></td>
				                    </tr>
				                </tbody>
				            </table>
				        </div> 
				        <div class="col-xs-6"  >
				        	<p><strong>Autres caractéristiques</strong></p> 
		        			 <table class="table table-condensed table table-bordered">
				                <tbody class="invoice_tbody">
				                    <tr t-foreach="o.service_ids" t-as="l">
				                        <td style="border: 1px solid black;"><span t-field="l.service_id.name"/></td>
				                        <td style="border: 1px solid black;"><span t-field="l.value"/></td>
				                    </tr>
				                </tbody>
				             </table>
				        </div> 
		       		</div>		
				    <div class="row" style="padding-top: 5px;">
		    			<table class="table table-condensed">
		    				<thead class="thead-light">
				                <tr>
			                        <th class="text-center" colspan="6">Opérations</th>
			                        <th class="text-center" colspan="2">Temps alloué</th>
			                        <th class="text-center" colspan="2">Temps passé</th>
			                        <th class="text-center" colspan="2">Coût Estimatif</th>
			                        <th class="text-center" colspan="2">Coût Réel</th>
			                        <th class="text-center" colspan="2">Prix Appliqué</th>
			                        <th class="text-center" colspan="2">Marge Réalisée</th>
				                </tr>
				            </thead>
				            <tr><th style="border-bottom: solid 1px black;" class="text-left" colspan="18">Appareil</th></tr>
			                <tbody>
			                	<t t-set="sub_total_allotted_time" t-value="0"/>
			                	<t t-set="sub_total_spent_time" t-value="0"/>
			                	<t t-set="sub_total_estimated_cost" t-value="0"/>
			                	<t t-set="sub_total_real_cost" t-value="0"/>
			                	<t t-set="sub_total_price" t-value="0"/>
			                	<t t-set="sub_total_marge" t-value="0"/>
			                	<t t-set="total_allotted_time" t-value="0"/>
			                	<t t-set="total_spent_time" t-value="0"/>
			                	<t t-set="total_estimated_cost" t-value="0"/>
			                	<t t-set="total_real_cost" t-value="0"/>
			                	<t t-set="total_price" t-value="0"/>
			                	<t t-set="total_marge" t-value="0"/>
			                    <tr t-foreach="o.operation_appareil_ids" t-as="l">
			                    	<t t-set="sub_total_allotted_time" t-value="sub_total_allotted_time+l.allotted_time"/>
			                    	<t t-set="sub_total_spent_time" t-value="sub_total_spent_time+l.spent_time"/>
			                    	<t t-set="sub_total_estimated_cost" t-value="sub_total_estimated_cost+l.estimated_cost"/>
			                    	<t t-set="sub_total_real_cost" t-value="sub_total_real_cost+l.real_cost"/>
			                    	<t t-set="sub_total_price" t-value="sub_total_price+l.price"/>
			                    	<t t-set="marge" t-value="0"/>
			                    	<t t-if="l.marge &gt;= 0">  
			                    		<t t-set="marge" t-value="l.marge"/>
			                    	</t>
			                    	<t t-set="sub_total_marge" t-value="sub_total_marge+marge"/>
			                        <td colspan="6"><span t-field="l.intervenant"/> <span t-field="l.operation_id.name"/></td>
			                        <td class="text-center" colspan="2"><span t-esc="time.strftime('%H:%M', time.gmtime(3600*l.allotted_time))"/></td>
			                        <td class="text-center" colspan="2"><span t-esc="time.strftime('%H:%M', time.gmtime(3600*l.spent_time))"/></td>
			                        <td class="text-center" colspan="2"><span t-esc="'%.2f'%(l.estimated_cost)"/></td>
			                        <td class="text-center" colspan="2"><span t-esc="'%.2f'%(l.real_cost)"/></td>
			                        <td class="text-center" colspan="2"><span t-esc="'%.2f'%(l.price)"/></td>
			                        <td class="text-center" colspan="2"><span t-esc="'%.2f'%(marge)"/></td>			                        
			                    </tr>
		                    	<tr> 
									<td colspan="6" style="border-bottom: solid 1px white"> </td>
									<td colspan="10" style="border-bottom: solid 1px"> </td>
								</tr>
								<tr> 
				                	 <t t-set="total_allotted_time" t-value="sub_total_allotted_time+total_allotted_time"/>
			                    	 <t t-set="total_spent_time" t-value="sub_total_spent_time+total_spent_time"/>
			                    	 <t t-set="total_estimated_cost" t-value="sub_total_estimated_cost+total_estimated_cost"/>
			                    	 <t t-set="total_real_cost" t-value="sub_total_real_cost+total_real_cost"/>
			                    	 <t t-set="total_price" t-value="sub_total_price+total_price"/>
			                    	 <t t-set="total_marge" t-value="sub_total_marge+total_marge"/>
									 
									 <td class="text-right" colspan="6"  style="border-bottom: solid 1px;"><strong>Sous Total :</strong></td>
									 <td class="text-center" colspan="2"  style="border-bottom: solid 1px;border-top: solid 1px;border-left: solid 1px;"><strong><span t-esc="time.strftime('%H:%M', time.gmtime(3600*sub_total_allotted_time))"/></strong></td>
			                         <td class="text-center" colspan="2" style="border-bottom: solid 1px;border-top: solid 1px;"><strong><span t-esc="time.strftime('%H:%M', time.gmtime(3600*sub_total_spent_time))"/></strong></td>
			                         <td class="text-center" colspan="2" style="border-bottom: solid 1px;border-top: solid 1px;"><strong><span t-esc="'%.2f'%(sub_total_estimated_cost)"/></strong></td>
			                         <td class="text-center" colspan="2" style="border-bottom: solid 1px;border-top: solid 1px;"><strong><span t-esc="'%.2f'%(sub_total_real_cost)"/></strong></td>
			                         <td class="text-center" colspan="2" style="border-bottom: solid 1px;border-top: solid 1px;"><strong><span t-esc="'%.2f'%(sub_total_price)"/></strong></td>
			                         <td class="text-center" colspan="2" style="border-bottom: solid 1px;border-top: solid 1px;border-right: solid 1px;"><strong><span t-esc="'%.2f'%(sub_total_marge)"/></strong></td>
								</tr>
			                </tbody>		                							
							<tbody class="invoice_tbody">
			                	<t t-set="product_piece" t-value="[]"/>
									<t t-foreach="o.operation_piece_ids.sorted(key=lambda b: b.piece_id.order_)" t-as="l">
									<t t-if="l.piece_id not in product_piece">								    
								   	 	<t t-set="product_piece" t-value="product_piece+[l.piece_id]"/> 
									</t>
								</t>
								<t t-foreach="product_piece" t-as="piece">
									<t t-set="sub_total_allotted_time" t-value="0"/>
				                	<t t-set="sub_total_spent_time" t-value="0"/>
				                	<t t-set="sub_total_estimated_cost" t-value="0"/>
				                	<t t-set="sub_total_real_cost" t-value="0"/>
				                	<t t-set="sub_total_price" t-value="0"/>
				                	<t t-set="sub_total_marge" t-value="0"/>
				                	<tr><td style="border-bottom: solid 1px white;" colspan="18"> </td></tr>
				                	<tr><td style="border-bottom: solid 1px black;" colspan="18"> </td></tr>
				                	<tr><th style="border-bottom: solid 1px black;" class="text-left" colspan="18"><span t-esc="piece.name"/>(<span t-esc="piece.no_piece"/>)</th></tr> 
								    <t t-foreach="o.operation_piece_ids" t-as="l">
								        <t t-if="piece.id==l.piece_id.id">
								        	<t t-set="sub_total_allotted_time" t-value="sub_total_allotted_time+l.allotted_time"/>
					                    	<t t-set="sub_total_spent_time" t-value="sub_total_spent_time+l.spent_time"/>
					                    	<t t-set="sub_total_estimated_cost" t-value="sub_total_estimated_cost+l.estimated_cost"/>
					                    	<t t-set="sub_total_real_cost" t-value="sub_total_real_cost+l.real_cost"/>
					                    	<t t-set="sub_total_price" t-value="sub_total_price+l.price"/>
					                    	<t t-set="marge" t-value="0"/>
					                    	<t t-if="l.marge &gt;= 0">  
			                    		         <t t-set="marge" t-value="l.marge"/>
			                    	        </t>
					                    	<t t-set="sub_total_marge" t-value="sub_total_marge+marge"/>
								            <tr>
								            	<td  colspan="6"><span t-field="l.intervenant"/> <span t-field="l.operation_id.name"/></td>
						                        <td class="text-center" colspan="2"><span t-esc="time.strftime('%H:%M', time.gmtime(3600*l.allotted_time))"/></td>
						                        <td class="text-center" colspan="2"><span t-esc="time.strftime('%H:%M', time.gmtime(3600*l.spent_time))"/></td>
						                        <td class="text-center" colspan="2"><span t-esc="'%.2f'%(l.estimated_cost)"/></td>
						                        <td class="text-center" colspan="2"><span t-esc="'%.2f'%(l.real_cost)"/></td>
						                        <td class="text-center" colspan="2"><span t-esc="'%.2f'%(l.price)"/></td>
						                        <td class="text-center" colspan="2"><span t-esc="'%.2f'%(marge)"/></td>
					                        </tr>
								        </t>
								    </t>
								    <tr> 
										<td colspan="6" style="border-bottom: solid 1px white"> </td>
										<td colspan="10" style="border-bottom: solid 1px"> </td>
									</tr>
								     <tr>
								     	 <t t-set="total_allotted_time" t-value="sub_total_allotted_time+total_allotted_time"/>
				                    	 <t t-set="total_spent_time" t-value="sub_total_spent_time+total_spent_time"/>
				                    	 <t t-set="total_estimated_cost" t-value="sub_total_estimated_cost+total_estimated_cost"/>
				                    	 <t t-set="total_real_cost" t-value="sub_total_real_cost+total_real_cost"/>
				                    	 <t t-set="total_price" t-value="sub_total_price+total_price"/>
				                    	 <t t-set="total_marge" t-value="sub_total_marge+total_marge"/>
								     	 
				                    	 <td class="text-right" colspan="6"  style="border-bottom: solid 1px"><strong>Sous Total :</strong></td>
										 <td class="text-center" colspan="2"  style="border-bottom: solid 1px;border-top: solid 1px;border-left: solid 1px;"><strong><span t-esc="time.strftime('%H:%M', time.gmtime(3600*sub_total_allotted_time))"/></strong></td>
				                         <td class="text-center" colspan="2" style="border-bottom: solid 1px;border-top: solid 1px;"><strong><span t-esc="time.strftime('%H:%M', time.gmtime(3600*sub_total_spent_time))"/></strong></td>
				                         <td class="text-center" colspan="2" style="border-bottom: solid 1px;border-top: solid 1px;"><strong><span t-esc="'%.2f'%(sub_total_estimated_cost)"/></strong></td>
				                         <td class="text-center" colspan="2" style="border-bottom: solid 1px;border-top: solid 1px;"><strong><span t-esc="'%.2f'%(sub_total_real_cost)"/></strong></td>
				                         <td class="text-center" colspan="2" style="border-bottom: solid 1px;border-top: solid 1px;"><strong><span t-esc="'%.2f'%(sub_total_price)"/></strong></td>
				                         <td class="text-center" colspan="2" style="border-bottom: solid 1px;border-top: solid 1px;border-right: solid 1px;"><strong><span t-esc="'%.2f'%(sub_total_marge)"/></strong></td>	
								     </tr>
								</t>
								<tr> 
									<td colspan="6" style="border-bottom: solid 1px white"> </td>
									<td colspan="10" style="border-bottom: solid 1px"> </td>
								</tr>
								<tr>
									 <td class="text-right" colspan="6" style="border-bottom: solid 1px"><strong>Total Commande : </strong></td>
									 <td class="text-center" colspan="2" style="border-bottom: solid 1px;border-top: solid 1px;border-left: solid 1px;"><strong><span t-esc="time.strftime('%H:%M', time.gmtime(3600*total_allotted_time))"/></strong></td>
			                         <td class="text-center" colspan="2" style="border-bottom: solid 1px;border-top: solid 1px;"><strong><span t-esc="time.strftime('%H:%M', time.gmtime(3600*total_spent_time))"/></strong></td>
			                         <td class="text-center" colspan="2" style="border-bottom: solid 1px;border-top: solid 1px;"><strong><span t-esc="'%.2f'%(total_estimated_cost)"/></strong></td>
			                         <td class="text-center" colspan="2" style="border-bottom: solid 1px;border-top: solid 1px;"><strong><span t-esc="'%.2f'%(total_real_cost)"/></strong></td>
			                         <td class="text-center" colspan="2" style="border-bottom: solid 1px;border-top: solid 1px;"><strong><span t-esc="'%.2f'%(total_price)"/></strong></td>
			                         <td class="text-center" colspan="2" style="border-bottom: solid 1px;border-top: solid 1px;border-right: solid 1px;"><strong><span t-esc="'%.2f'%(total_marge)"/></strong></td>
								</tr>
			                </tbody>			                
			            </table>
		       		</div> 	
		       	</div> 
	        	</t>
	        <t t-call="arfi.product_order_devis_layout">
                <div class="page">
		       		<div class="row" style="padding-top: 15px;">
		       			<p><u><strong>Observations :</strong></u></p>
		       			<p t-raw="o.obs_recap"/>
		       		</div> 
		       	</div>
	        </t>
	        </t>
	   </t>
       
</template>
</odoo>